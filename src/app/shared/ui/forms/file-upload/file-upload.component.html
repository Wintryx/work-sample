<app-form-field-shell [control]="control()" [validators]="validators()" [decorateControl]="true">
  <div class="flex flex-col gap-2">
    <label class="text-sm font-medium text-slate-700" [attr.for]="inputId">{{ label() }}</label>

    <div class="flex items-center gap-4">
      <button mat-stroked-button type="button" (click)="fileInput.click()" [disabled]="uploading()">
        <mat-icon>cloud_upload</mat-icon>
        Select Images
      </button>
      <input
        #fileInput
        [id]="inputId"
        type="file"
        class="hidden"
        [accept]="accept()"
        [multiple]="multiple()"
        (change)="onFileSelected($event)"
      />
    </div>

    @if (uploads().length) {
      <ul class="text-sm text-slate-600 space-y-1">
        @for (item of uploads(); track $index) {
          <li class="flex items-center gap-2">
            @switch (item.status) {
              @case ("done") {
                <mat-icon class="!w-4 !h-4 text-[16px] text-green-600">check_circle</mat-icon>
              }
              @case ("error") {
                <mat-icon class="!w-4 !h-4 text-[16px] text-red-600">error</mat-icon>
              }
              @case ("uploading") {
                <mat-icon class="!w-4 !h-4 text-[16px] text-blue-600">sync</mat-icon>
              }
              @default {
                <mat-icon class="!w-4 !h-4 text-[16px] text-slate-400">schedule</mat-icon>
              }
            }
            <span class="truncate">{{ item.name }}</span>
            @if (item.status === "error") {
              <span class="text-xs text-red-600">{{ item.error || "Upload failed." }}</span>
            }
          </li>
        }
      </ul>
    }

    @if (uploading()) {
      <div class="flex items-center justify-between text-xs text-slate-500">
        @if (currentIndex() !== null) {
          <span>Uploading {{ (currentIndex() ?? 0) + 1 }} / {{ uploads().length }}</span>
        } @else {
          <span>Uploading...</span>
        }
        @if (currentFileName()) {
          <span class="truncate">{{ currentFileName() }}</span>
        }
      </div>
      <mat-progress-bar mode="determinate" [value]="progress()"></mat-progress-bar>
    }

    @if (error()) {
      <span class="text-xs text-red-600">{{ error() }}</span>
    }

    @if (uploadedCount() > 0 && !uploading()) {
      <span class="text-xs text-green-600 flex items-center gap-1">
        <mat-icon class="!w-4 !h-4 text-[16px]">check_circle</mat-icon>
        Upload complete ({{ uploadedCount() }} files)
      </span>
    }
  </div>
</app-form-field-shell>
